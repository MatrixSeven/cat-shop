<wxs module="m2">
    var imgToFix = function (value) {
        if (value&&value.imgs) {
            return value.imgs.split(',')
        }
        if (value&&value.mainPic) {
            return [value.mainPic]
        }
        return value
    }
    module.exports.imgToFix = imgToFix;

    var numToFix = function (value) {
        if (value) {
            return value.toFixed(2)
        }
        return value
    }
    module.exports.numToFix = numToFix;
</wxs>

<van-popup
        show="{{ showBuy }}"
        closeable
        round
        duration="500"
        overlay="{{true}}"
        bind:close="closeBuy">
    <view class="buy_plan">
        <view class="buy_title">
            å£ä»¤è´­ä¹°
        </view>
        <view class="buy_ling">
            <textarea focus="{{false}}"
                      disabled="{{canEdit}}"
                      value="{{detail.ling}}"/>
        </view>
        <view class="buy_step" style="flex-direction: column" bind:tap="copyLing">
            <view style="display:flex;justify-content:center">
                <van-button round custom-style="width:75vw" color="#dd514c">
                    ç‚¹å‡»ä¸€é”®å¤åˆ¶
                </van-button>
            </view>
            <view class="buy_button_text">
                å¦‚æœå¤åˆ¶å¤±è´¥,è¯·æ‰‹åŠ¨å¤åˆ¶å£ä»¤
            </view>
        </view>
    </view>

</van-popup>

<van-dialog
        title="è®¢é˜…ç»­è®¢æé†’"
        message="ğŸ‰ä½ è®¢é˜…çš„å…³é”®å­—'{{subKey}}'åˆ°å•¦ï½ç”±äºå¾®ä¿¡é™åˆ¶ï¼Œä¸ºäº†ä¿è¯æ¨é€æ•ˆæœ,èµ¶ç´§ç»­è®¢å§ï¼Œå¦‚ç®¡ç†è®¢é˜…å†…å®¹è¯·åˆ°æˆ‘çš„->è®¢é˜…ç®¡ç†é¡µé¢å»ç®¡ç†å“¦"
        show="{{ showSub }}"
        confirm-button-text="æŸ¥çœ‹å•†å“&ç»­è®¢"
        bind:tap="onSubscribe">
</van-dialog>

<navBar searchBar="{{false}}" bindback="gotoBack" bindHome="gotoHomeReLaunch" title="å•†å“è¯¦æƒ…"
        background='#fff' back="{{!showGoHome}}" home="{{showGoHome}}"/>

<view class="container detail-container" wx:if="detail">
    <swiper class='carousel_swiper' indicator-dots="true" indicator-color="#f4f4f4" indicator-active-color="#ec6933"
            autoplay="true" interval='2000' circular='true'>
        <block wx:for="{{m2.imgToFix(detail)}}" wx:key="item">
            <swiper-item bindtap='tapGallery' data-url='{{item}}'>
                <image class="carouselImg" src='{{item}}' mode='aspectFill'></image>
            </swiper-item>
        </block>
    </swiper>
    <view class="detail-top-info">
        <view class="top-info-price">
            <view class="price-left" wx:if="{{m2.numToFix(detail.actualPrice)}}">
                <view>
                    <text class="ppre">ï¿¥</text><text
                        class="cprice">{{detail.actualPrice}}</text>
                </view>
                <view class="qafter">åˆ¸åä»·</view>
                <text class="oprice">ï¿¥{{m2.numToFix(detail.originalPrice)}}</text>
            </view>
            <text class="price-right" wx:if="{{detail.monthSales}}">å·²æ‹¼{{detail.monthSales}}ä»¶</text>
        </view>
        <view class="top-info-name">
            <text>{{detail.title}}</text>
        </view>
    </view>
    <view class="detail-discount" wx:if="{{detail.title}}" bindtap="buy">
        <text class="discount-text"
              wx:if="{{detail.originalPrice-detail.actualPrice===0}}">æ— å¯ç”¨ä¼˜æƒ åˆ¸</text>
        <text class="discount-text"
              wx:if="{{detail.originalPrice-detail.actualPrice> 0}}">ï¿¥{{m2.numToFix(detail.originalPrice - detail.actualPrice)}}</text>
        <view class="discount-time" wx:if="{{detail.couponStartTime}}">
            <text>ä¼˜æƒ åˆ¸ä½¿ç”¨æœŸé™</text>
            <text wx:if="{{couponStartTime}}"> {{couponStartTime}} ~ {{couponEndTime}}</text>
            <text wx:if="{{!couponStartTime}}">é•¿æœŸæœ‰æ•ˆ</text>
        </view>
        <view class="discount-yline" wx:if="{{detail.title}}"></view>
        <text class="discount-action" wx:if="{{detail.title}}">ç«‹å³é¢†åˆ¸</text>
    </view>
    <view class="detail-info" wx:if="{{detail.title}}">
        <view style="align-self: flex-start; margin-bottom:2vh;align-items: flex-start;just-content:flex-start;display: flex;flex-direction: column;border-width: thin;border-style: dashed; width:98%;border-color: #dd514c;border-bottom-style: dot-dash;">
            <text class="detail-name">å•†å“è¯¦æƒ…:</text>
            <text class="detail-desc">{{detail.desc}}</text>
            <text class="detail-name">ç¾¤å‹å‘è½¦è®°å½•:</text>
            <text class="detail-desc">{{detail.syncMsg}}</text>
        </view>
        <image wx:for="{{m2.imgToFix(detail)}}" src="{{item}}"/>
    </view>

</view>
<van-goods-action>
    <van-goods-action-icon icon="chat-o" text="å®¢æœ" bind:click="openWxQr"/>
    <van-goods-action-icon link-type="redirectTo" url="pages/cat/cat" icon="shop-collect-o" text="é¦–é¡µ"
                           bind:tap="gotoHome"/>
    <van-goods-action-button
            open-type="share"
            text="åˆ†äº«ç»™å¥½å‹"
            color="#f47920"
    />
    <van-goods-action-button color="#dd514c" text="ç«‹å³è´­ä¹°" bind:click="buy"/>
</van-goods-action>